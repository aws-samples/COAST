{
  "__inputs": [
    {
      "name": "Datasource",
      "label": "COAST-2023-09-19",
      "description": "",
      "type": "datasource",
      "pluginId": "grafana-athena-datasource",
      "pluginName": "Amazon Athena"
    }
  ],
  "__elements": {},
  "__requires": [
    {
      "type": "panel",
      "id": "barchart",
      "name": "Bar chart",
      "version": ""
    },
    {
      "type": "panel",
      "id": "gauge",
      "name": "Gauge",
      "version": ""
    },
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "9.4.7"
    },
    {
      "type": "datasource",
      "id": "grafana-athena-datasource",
      "name": "Amazon Athena",
      "version": "2.8.0"
    },
    {
      "type": "panel",
      "id": "stat",
      "name": "Stat",
      "version": ""
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "text",
      "name": "Text",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "datasource",
          "uid": "grafana"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "target": {
          "limit": 100,
          "matchAny": false,
          "tags": [],
          "type": "dashboard"
        },
        "type": "dashboard"
      }
    ]
  },
  "description": "Advanced Cost and Usage Analysis Dashboard",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [
    {
      "asDropdown": false,
      "icon": "external link",
      "includeVars": false,
      "keepTime": false,
      "tags": [],
      "targetBlank": true,
      "title": "Cost Explorer",
      "tooltip": "Cost Explorer",
      "type": "link",
      "url": "https://console.aws.amazon.com/cost-management/home?#/custom?excludeCategorizedResources=false&excludeDiscounts=true&excludeTaggedResources=false&filter=%5B%5D&granularity=Monthly&groupBy=None&hasAmortized=false&hasBlended=false&isTemplate=true&reportName=&reportType=CostUsage&timeRangeOption=Last6Months&chartStyle=Group&forecastTimeRangeOption=None&usageAs=usageQuantity&excludeForecast=false&startDate=2022-04-01&endDate=2022-09-30"
    }
  ],
  "liveNow": false,
  "panels": [
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 58,
      "panels": [
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "",
          "gridPos": {
            "h": 21,
            "w": 24,
            "x": 0,
            "y": 1
          },
          "id": 38,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "<div style='font-size: 18px'>\n<span style='color: #AF69EE;font-weight: bold'>C</span>ost <span style='color: #AF69EE;font-weight: bold'>O</span>ptimization <span style='color: #AF69EE;font-weight: bold'>A</span>nd <span style='color: #AF69EE;font-weight: bold'>S</span>avings <span style='color: #AF69EE;font-weight: bold'>T</span>ool (<span style='color: #AF69EE;font-weight: bold'>COAST</span>) for Amazon Managed Grafana\n</div>\nCOAST is a set of customizable Amazon Managed Grafana\ndashboards which provide a summary view as well as granular \nservice level views based on the AWS Cost and Usage Report (CUR).  \nDashboards include specific views tailored for executive leadership, \nFinOps Practitioners and DevOps/Engineering.\n<br><br>\n<div style='font-size: 18px'>\nAbout this Dashboard\n</div>\n\nThe <span style='color: #AF69EE'>FinOps Dashboard</span> is a comprehensive tool designed specifically for the Cloud Center of Excellence and FinOps practitioners within your organization. Its primary objective is to offer a convenient and insightful way to manage and analyze cloud spending, enabling informed financial decisions related to your cloud infrastructure.\n<br><br>\n\n<strong>Key Features and Benefits:</strong>\n\n    <ul>\n    <li>Invoice Spend Tracking: One of the central features of this dashboard is its ability to meticulously track invoice spend. By aggregating and visualizing invoice data, it provides a clear and detailed overview of your organization's financial commitments, helping you ensure that your cloud resources stay within budget.</li>\n\n    <li>General Spend Summaries: In addition to invoice spend, this dashboard offers general spend summaries. It provides an overview of how resources across various accounts are being utilized and where costs are incurred. This high-level view helps in identifying trends and optimizing spending patterns.</li>\n\n    <li>Commitment-Based Spend: A critical aspect of cloud cost management is commitment-based spending. The dashboard includes specialized views and insights into your organization's commitments and usage. By tracking commitments, you can ensure that your cloud resources align with your organization's budgetary goals.</li>\n\n    <li>Multi-Account Support: We recommend using this dashboard at the payer level, allowing you to monitor and manage spend and usage across all linked accounts. This comprehensive view ensures that all accounts are aligned with your financial objectives, enabling better control and optimization.</li>\n    </ul>\n\n<strong>How to Utilize this Dashboard:</strong>\n<br><br>\nTo make the most of the FinOps Dashboard, consider the following steps:\n<br><br>\n\n    <ul>\n    <li>Regular Monitoring: Regularly review the dashboard to monitor your organization's cloud spend. Keep a close eye on invoice spend, commitments, and general summaries to identify any discrepancies or areas where cost savings can be achieved.</li>\n\n    <li>Cost Optimization: Use the insights provided by the dashboard to optimize your cloud resources. Identify areas where resource usage can be scaled down or reconfigured to reduce costs without compromising performance.</li>\n\n    <li>Commitment Management: Manage your commitment-based spend effectively by tracking your commitments and ensuring that they align with actual usage. The dashboard provides data to help you make informed decisions about adjustments to commitments.</li>\n\n    <li>Collaboration: Share the dashboard with relevant teams and stakeholders within your organization. Encourage collaboration between finance, IT, and operations teams to jointly manage and optimize cloud costs.</li>\n\n    <li>Periodic Reviews: Schedule periodic reviews and discussions based on the information presented in the dashboard. This helps in aligning cloud spending with your organization's evolving needs and financial goals.</li>\n    </ul>\n\nThe FinOps Dashboard is a powerful tool that empowers your organization to take control of cloud costs, optimize spending, and make data-driven financial decisions. By leveraging its capabilities, you can ensure that your cloud resources are not only efficient but also cost-effective.\n\n<br><br>\nIf you have any questions or need further assistance in interpreting the data or utilizing the dashboard's features, please reach out to your designated Cloud Financial Analyst or FinOps Manager for guidance and support.\n",
            "mode": "html"
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "refId": "A"
            }
          ],
          "title": " ",
          "type": "text"
        }
      ],
      "title": "Dashboard Overview",
      "type": "row"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 1
      },
      "id": 60,
      "panels": [],
      "title": "Invoice View",
      "type": "row"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "grafana"
      },
      "gridPos": {
        "h": 2,
        "w": 24,
        "x": 0,
        "y": 2
      },
      "id": 76,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "<div>\nThe Invoice View section displays invoice amounts and will match the amounts in your AWS Bills page.\nIt is only reactive to the date, linked accounts and regions filters (not tagging).\n</div>\n\n<div>\n  For more billing details navigate to the: \n  <a href=\"https://us-east-1.console.aws.amazon.com/billing/home?region=us-east-1#/bills\" target=\"_blank\">Account Billing Page</a>\n</div>",
        "mode": "html"
      },
      "pluginVersion": "9.4.7",
      "type": "text"
    },
    {
      "datasource": {
        "type": "grafana-athena-datasource",
        "uid": "${Datasource}"
      },
      "description": "The invoice panel allows for filtering by accounts and regions only.  This panel displays the current number of accounts and regions used to calculate the invoice sums.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-BlPu"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 8,
        "x": 0,
        "y": 4
      },
      "id": 67,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "format": 1,
          "rawSQL": "SELECT \nCOUNT(DISTINCT(line_item_usage_account_id)) as Accounts,\nCOUNT(DISTINCT(product_location)) as Regions\nFROM $CurTable\nWHERE \nproduct_location in ($Regions)\nAND line_item_usage_account_id IN ($LinkedAccounts)",
          "refId": "A"
        }
      ],
      "title": "Selected Account/Region Count for Invoice",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-athena-datasource",
        "uid": "${Datasource}"
      },
      "description": "The invoice panel allows for filtering by accounts and regions only.  This panel displays invoice amount two months ago.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-BlPu"
          },
          "decimals": 2,
          "mappings": [],
          "noValue": "0",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 8,
        "y": 4
      },
      "id": 64,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "value"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "format": 1,
          "rawSQL": "-- Output number for last months bill\nSELECT \nSUM(line_item_unblended_cost)\nFROM $CurTable\nwhere\nbill_billing_period_start_date = date_add('MONTH', -2, DATE_TRUNC('MONTH', current_date) )\nAND product_location in ($Regions)\nAND line_item_usage_account_id IN ($LinkedAccounts)",
          "refId": "A"
        }
      ],
      "title": "Invoice Two Months Ago (unblended)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-athena-datasource",
        "uid": "${Datasource}"
      },
      "description": "The invoice panel allows for filtering by accounts and regions only.  This panel displays the invoice amount for last month.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-BlPu"
          },
          "decimals": 2,
          "mappings": [],
          "noValue": "0",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 12,
        "y": 4
      },
      "id": 62,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "value"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "format": 1,
          "rawSQL": "-- Output number for last months bill\nSELECT \nSUM(line_item_unblended_cost)\nFROM $CurTable\nwhere\nbill_billing_period_start_date = date_add('MONTH', -1, DATE_TRUNC('MONTH', current_date) )\nAND product_location in ($Regions)\nAND line_item_usage_account_id IN ($LinkedAccounts)",
          "refId": "A"
        }
      ],
      "title": "Invoice Last Month (unblended)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-athena-datasource",
        "uid": "${Datasource}"
      },
      "description": "The invoice panel allows for filtering by accounts and regions only.  Your invoice trend over the past two invoices.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-BlPu"
          },
          "decimals": 0,
          "mappings": [],
          "noValue": "0",
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {
                "color": "#FF9830",
                "value": null
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 5,
        "x": 16,
        "y": 4
      },
      "id": 63,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "value"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "format": 1,
          "rawSQL": "-- Output the bill sum last two months\nWITH bill_sum_last_two_months as (\n  SELECT \n  SUM(CASE\n        WHEN (bill_billing_period_start_date = date_add('MONTH', -2, DATE_TRUNC('MONTH', current_date))) THEN line_item_unblended_cost ELSE 0 \n      END) AS bill_two_months_ago,\n  SUM(CASE\n        WHEN (bill_billing_period_start_date = date_add('MONTH', -1, DATE_TRUNC('MONTH', current_date))) THEN line_item_unblended_cost ELSE 0 \n      END) AS bill_one_month_ago\n  FROM $CurTable\n  where\n  ( bill_billing_period_start_date = date_add('MONTH', -2, DATE_TRUNC('MONTH', current_date))\n  OR bill_billing_period_start_date = date_add('MONTH', -1, DATE_TRUNC('MONTH', current_date)) )  \n  AND product_location in ($Regions)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n),\n\n-- output percentage change for bill in last two months\nbill_percentage_change as (\nSELECT \n  bill_two_months_ago,\n  bill_one_month_ago,\n  CAST(bill_one_month_ago - bill_two_months_ago as double) as spend_difference,\n  CAST(((bill_one_month_ago - bill_two_months_ago) / bill_two_months_ago) * 100 as double) as percentage_change\nFROM \nbill_sum_last_two_months\n)\n\nSELECT \npercentage_change\nFROM \nbill_percentage_change",
          "refId": "A"
        }
      ],
      "title": "Invoice Trend Past Two Months",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-athena-datasource",
        "uid": "${Datasource}"
      },
      "description": "The invoice panel allows for filtering by accounts and regions only.  Your invoice trend year to date.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-BlPu"
          },
          "decimals": 0,
          "mappings": [],
          "noValue": "0",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 21,
        "y": 4
      },
      "id": 65,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "value"
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "format": 1,
          "rawSQL": "-- Output the bill sum from jan of this year and last month\nWITH bill_sum_ytd_and_last_month as (\n  SELECT \n  SUM(CASE\n        WHEN (bill_billing_period_start_date = date_add('YEAR', 0, DATE_TRUNC('YEAR', current_date))) THEN line_item_unblended_cost ELSE 0 \n      END) AS bill_january,\n  SUM(CASE\n        WHEN (bill_billing_period_start_date = date_add('MONTH', -1, DATE_TRUNC('MONTH', current_date))) THEN line_item_unblended_cost ELSE 0 \n      END) AS bill_one_month_ago\n  FROM $CurTable\n  where\n  ( bill_billing_period_start_date = date_add('YEAR', 0, DATE_TRUNC('YEAR', current_date))\n  OR bill_billing_period_start_date = date_add('MONTH', -1, DATE_TRUNC('MONTH', current_date)) )  \n  AND product_location in ($Regions)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n),\n\n-- output percentage change ytd\nbill_percentage_change as (\n  SELECT \n    bill_january,\n    bill_one_month_ago,\n    CAST(bill_one_month_ago - bill_january as double) as spend_difference,\n    CAST(((bill_one_month_ago - bill_january) / bill_january) * 100 as double) as percentage_change\n  FROM \n  bill_sum_ytd_and_last_month\n)\n\nSELECT \npercentage_change\nFROM \nbill_percentage_change",
          "refId": "A"
        }
      ],
      "title": "Invoice Trend YTD",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "datasource",
        "uid": "grafana"
      },
      "gridPos": {
        "h": 7,
        "w": 4,
        "x": 0,
        "y": 8
      },
      "id": 71,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "<div style='font-size: 18px'>\nTotal linked accounts in AWS Organization: ${TotalAccountInOrganization}\n<br><br>\n\nPercentage of spend from top 10 accounts: ${PanelTop25SpendPercentage}%\n</div>",
        "mode": "html"
      },
      "pluginVersion": "9.4.7",
      "type": "text"
    },
    {
      "datasource": {
        "type": "grafana-athena-datasource",
        "uid": "${Datasource}"
      },
      "description": "The invoice panel allows for filtering by accounts and regions only.  Top 10 accounts by spend in last month's invoice.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-BlPu"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "series",
            "axisLabel": "Dollars ($)",
            "axisPlacement": "auto",
            "fillOpacity": 46,
            "gradientMode": "opacity",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "none"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 10,
        "x": 4,
        "y": 8
      },
      "id": 69,
      "options": {
        "barRadius": 0,
        "barWidth": 0.79,
        "colorByField": "account",
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [
            "sum"
          ],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "text": {},
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xField": "account",
        "xTickLabelMaxLength": 15,
        "xTickLabelRotation": -45,
        "xTickLabelSpacing": 0
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "format": 1,
          "rawSQL": "SELECT \nCAST(line_item_usage_account_id as varchar) as account,\nCAST(sum(line_item_unblended_cost) as integer) as spend\nFROM $CurTable\nwhere\nbill_billing_period_start_date = date_add('MONTH', -1, date_trunc('MONTH', current_date))\nAND product_location in ($Regions)\nAND line_item_usage_account_id IN ($LinkedAccounts)\nGROUP BY\nline_item_usage_account_id\nORDER BY \nspend DESC\nLIMIT 10\n",
          "refId": "A"
        }
      ],
      "title": "Top 10 Accounts - Invoice Last Month",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "grafana-athena-datasource",
        "uid": "${Datasource}"
      },
      "description": "The invoice panel allows for filtering by accounts and regions only.  Trends in the top 10 spend accounts over the past two months.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "continuous-BlPu"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 46,
            "gradientMode": "opacity",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "displayName": "Percentage Difference",
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 10,
        "x": 14,
        "y": 8
      },
      "id": 72,
      "options": {
        "barRadius": 0,
        "barWidth": 0.79,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xField": "account",
        "xTickLabelMaxLength": 15,
        "xTickLabelRotation": -45,
        "xTickLabelSpacing": 0
      },
      "pluginVersion": "9.4.7",
      "targets": [
        {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "format": 1,
          "rawSQL": "with spend_difference as (\n    SELECT\n    line_item_usage_account_id as account,\n    SUM(\n        CASE\n        WHEN(bill_billing_period_start_date = date_add('MONTH', -1, DATE_TRUNC('MONTH', current_date))) THEN line_item_unblended_cost\n    END) as cost_one_month_ago,\n    SUM(\n        CASE\n        WHEN(bill_billing_period_start_date = date_add('MONTH', -2, DATE_TRUNC('MONTH', current_date))) THEN line_item_unblended_cost\n    END) as cost_two_months_ago\n    FROM\n    $CurTable\n    where\n    ( bill_billing_period_start_date = date_add('MONTH', -1, DATE_TRUNC('MONTH', current_date)) \n    OR bill_billing_period_start_date = date_add('MONTH', -2, DATE_TRUNC('MONTH', current_date)) )\n    AND product_location in ($Regions)\n    AND line_item_usage_account_id IN ($LinkedAccounts)\n    Group by \n    line_item_usage_account_id\n    ORDER BY \n    account DESC\n    LIMIT 10\n)\n\nSELECT\n    account,\n    (((cost_one_month_ago - cost_two_months_ago) / cost_two_months_ago) * 100) as spend_percentage_diff\nFROM\nspend_difference\nORDER BY spend_percentage_diff",
          "refId": "A"
        }
      ],
      "title": "Top 10 - Account change over last two invoices",
      "type": "barchart"
    },
    {
      "collapsed": true,
      "datasource": {
        "type": "datasource",
        "uid": "grafana"
      },
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 15
      },
      "id": 36,
      "panels": [
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Total spend trend as represented by SUM of line_item_unblended_cost aggregated by bill_billing_period_start_date (monthly).",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "scheme",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 850
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 18,
            "x": 0,
            "y": 3
          },
          "id": 40,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "desc"
            }
          },
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 0,
              "rawSQL": "SELECT\n  date_trunc('$Granularity', line_item_usage_start_date),\n  sum(line_item_unblended_cost) AS cost\nfrom $CurTable\nWHERE\n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\nGROUP BY 1\nORDER BY 1\n;",
              "refId": "A"
            }
          ],
          "thresholds": [],
          "title": "Monthly Spend for Period (unblended)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Total spend as represented by SUM of line_item_unblended_cost aggregated by bill_billing_period_start_date (monthly).",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 6,
            "x": 18,
            "y": 3
          },
          "id": 48,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "text": {},
            "textMode": "auto"
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 1,
              "rawSQL": "SELECT\n  sum(line_item_unblended_cost) AS cost\nfrom $CurTable\nWHERE\n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\n;\n",
              "refId": "A"
            }
          ],
          "title": "Total Spend for Period (unblended)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Total spend by service as represented by  SUM of line_item_unblended_cost aggregated by bill_billing_period_start_date (monthly).  Displaying all customers with spend in a service which is greater than $1.  You can edit this dollar amount, buy editing the HAVING line in the query.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "purple",
                "mode": "continuous-BlPu",
                "seriesBy": "max"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "left",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "scheme",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "displayName": "${__field.labels.product}",
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue"
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 18,
            "x": 0,
            "y": 12
          },
          "id": 42,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "desc"
            }
          },
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 0,
              "rawSQL": "SELECT\n  date_trunc('$Granularity', line_item_usage_start_date),\n  line_item_product_code as product,\n  CAST(SUM(line_item_unblended_cost) as INTEGER) as cost\nfrom $CurTable\nWHERE\n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\nGROUP BY 1, 2\nHAVING CAST(SUM(line_item_unblended_cost) as INTEGER) > 1\nORDER BY 1\n;",
              "refId": "A"
            }
          ],
          "title": "Monthly Spend Per Service (unblended)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Top service (by spend) during the selected time period (unblended)",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80.0004
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 6,
            "x": 18,
            "y": 12
          },
          "id": 50,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/.*/",
              "values": false
            },
            "text": {},
            "textMode": "value"
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 1,
              "rawSQL": "SELECT\n  line_item_product_code as product,\n  sum(line_item_blended_cost) as cost\nfrom $CurTable\nWHERE\n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\nGROUP BY 1\nORDER BY 2 DESC\nLIMIT 1\n;",
              "refId": "A"
            }
          ],
          "title": "Top Service Spend for Period (unblended)",
          "transformations": [
            {
              "id": "sortBy",
              "options": {
                "fields": {},
                "sort": [
                  {
                    "field": "product"
                  }
                ]
              }
            }
          ],
          "type": "stat"
        }
      ],
      "targets": [
        {
          "datasource": {
            "type": "datasource",
            "uid": "grafana"
          },
          "refId": "A"
        }
      ],
      "title": "Summary View",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 16
      },
      "id": 56,
      "panels": [
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Total spend by region as represented by SUM of line_item_unblended_cost aggregated by bill_billing_period_start_date (monthly). Displaying all customers with spend in a region which is greater than $1. You can edit this dollar amount, buy editing the HAVING line in the query.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "scheme",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "displayName": "${__field.labels.location}",
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 0,
            "y": 4
          },
          "id": 44,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "desc"
            }
          },
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 0,
              "rawSQL": "select \n  date_trunc('$Granularity', line_item_usage_start_date),\n  product_location as location,\n  CAST(SUM(line_item_unblended_cost) as INTEGER) as cost\nfrom $CurTable\nWHERE\n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\nGROUP BY 1, 2\nHAVING CAST(SUM(line_item_unblended_cost) as INTEGER) > 1\nORDER BY 1\n;",
              "refId": "A"
            }
          ],
          "title": "Region Spend Trend for Period (unblended)",
          "transformations": [
            {
              "id": "renameByRegex",
              "options": {
                "regex": "cost 1",
                "renamePattern": "No region"
              }
            }
          ],
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Total spend by region as represented by SUM of line_item_unblended_cost aggregated by bill_billing_period_start_date (monthly). Displaying all customers with spend in a region which is greater than $1. You can edit this dollar amount, buy editing the HAVING line in the query.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 12,
            "y": 4
          },
          "id": 46,
          "options": {
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showThresholdLabels": false,
            "showThresholdMarkers": true,
            "text": {}
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 0,
              "rawSQL": "SELECT\n  product_location as location,\n  CAST(SUM(line_item_unblended_cost) as INTEGER) as cost\nfrom $CurTable\nWHERE\n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\nGROUP BY 1\nHAVING CAST(SUM(line_item_unblended_cost) as INTEGER) > 1\nORDER BY cost DESC",
              "refId": "A"
            }
          ],
          "title": "Region Total Spend for Period (unblended)",
          "transformations": [
            {
              "id": "rowsToFields",
              "options": {}
            }
          ],
          "type": "gauge"
        }
      ],
      "title": "Region Activity",
      "type": "row"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 17
      },
      "id": 78,
      "panels": [
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Amortized breakdown of On-Demand, Reserved and Savings plan for Amazon EC2.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "scheme",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 2,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 5
          },
          "id": 80,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 1,
              "rawSQL": "SELECT \n  date_trunc('$Granularity', line_item_usage_start_date),\n  SUM(CAST(CASE\n    WHEN line_item_line_item_type IN ('Usage') AND line_item_usage_type NOT LIKE '%SpotUsage%' THEN line_item_unblended_cost\n    ELSE 0\n    END AS DOUBLE)) AS \"On-Demand\",\n  SUM(CAST(savings_plan_savings_plan_effective_cost AS DOUBLE)) AS \"Savings Plan\",\n  SUM(CAST(reservation_effective_cost AS DOUBLE)) AS \"Reserved\",\n  SUM(CAST(CASE\n    WHEN line_item_usage_type LIKE '%SpotUsage%' THEN line_item_unblended_cost\n    ELSE 0\n    END AS DOUBLE)) AS \"Spot\"\nFROM \n  $CurTable\nWHERE \n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\n  AND line_item_product_code = 'AmazonEC2'\n  AND line_item_operation LIKE '%RunInstance%'\n  -- AND line_item_line_item_type IN ('Usage','SavingsPlanCoveredUsage', 'Fee','RIFee','DiscountedUsage')\n  AND product_product_family NOT IN ('Data Transfer')\nGROUP BY \n  1",
              "refId": "A"
            }
          ],
          "title": "EC2 Purchase Type Coverage -  Amortized",
          "transformations": [
            {
              "id": "groupBy",
              "options": {
                "fields": {
                  "case_purchase_option": {
                    "aggregations": [
                      "sum"
                    ]
                  },
                  "sum_amortized_cost": {
                    "aggregations": [
                      "sum"
                    ]
                  }
                }
              }
            }
          ],
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Breakdown of Amazon RDS On-Demand and Reserved Instance Coverage",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "scheme",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 2,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 5
          },
          "id": 81,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 1,
              "rawSQL": "SELECT \n  date_trunc('$Granularity', line_item_usage_start_date),\n  SUM(CAST(CASE\n    WHEN line_item_line_item_type IN ('Usage') THEN line_item_unblended_cost\n    ELSE 0\n    END AS DOUBLE)) AS \"On-Demand\",\n  SUM(CAST(reservation_effective_cost AS DOUBLE)) AS \"Reserved\",\n  SUM(CAST(reservation_unused_amortized_upfront_fee_for_billing_period AS DOUBLE) + CAST(reservation_unused_recurring_fee AS DOUBLE)) AS \"Unused Reserved\"\nFROM \n  $CurTable\nWHERE \n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\n  AND line_item_product_code = 'AmazonRDS'\n  -- AND line_item_line_item_type IN ('Usage','Fee','RIFee','DiscountedUsage')\n  AND product_product_family NOT IN ('Data Transfer')\nGROUP BY \n  1",
              "refId": "A"
            }
          ],
          "title": "RDS Purchase Type Coverage -  Amortized",
          "transformations": [
            {
              "id": "groupBy",
              "options": {
                "fields": {
                  "case_purchase_option": {
                    "aggregations": [
                      "sum"
                    ]
                  },
                  "sum_amortized_cost": {
                    "aggregations": [
                      "sum"
                    ]
                  }
                }
              }
            }
          ],
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Breakdown of Amazon OpenSearch On-Demand and Reserved Instance Coverage",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "scheme",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 2,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 13
          },
          "id": 82,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 1,
              "rawSQL": "SELECT \n  date_trunc('$Granularity', line_item_usage_start_date),\n  SUM(CAST(CASE\n    WHEN line_item_line_item_type IN ('Usage') THEN line_item_unblended_cost\n    ELSE 0\n    END AS DOUBLE)) AS \"On-Demand\",\n  SUM(CAST(reservation_effective_cost AS DOUBLE)) AS \"Reserved\",\n  SUM(CAST(reservation_unused_amortized_upfront_fee_for_billing_period AS DOUBLE) + CAST(reservation_unused_recurring_fee AS DOUBLE)) AS \"Unused Reserved\"\nFROM \n  $CurTable\nWHERE \n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\n  AND line_item_product_code = 'AmazonES'\n  -- AND line_item_line_item_type IN ('Usage','Fee','RIFee','DiscountedUsage')\n  AND product_product_family NOT IN ('Data Transfer')\nGROUP BY \n  1",
              "refId": "A"
            }
          ],
          "title": "OpenSearch Purchase Type Coverage -  Amortized",
          "transformations": [
            {
              "id": "groupBy",
              "options": {
                "fields": {
                  "case_purchase_option": {
                    "aggregations": [
                      "sum"
                    ]
                  },
                  "sum_amortized_cost": {
                    "aggregations": [
                      "sum"
                    ]
                  }
                }
              }
            }
          ],
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Breakdown of Amazon ElastiCache On-Demand and Reserved Instance Coverage",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "scheme",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 2,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 13
          },
          "id": 83,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 1,
              "rawSQL": "SELECT \n  date_trunc('$Granularity', line_item_usage_start_date),\n  SUM(CAST(CASE\n    WHEN line_item_line_item_type IN ('Usage') THEN line_item_unblended_cost\n    ELSE 0\n    END AS DOUBLE)) AS \"On-Demand\",\n  SUM(CAST(reservation_effective_cost AS DOUBLE)) AS \"Reserved\",\n  SUM(CAST(reservation_unused_amortized_upfront_fee_for_billing_period AS DOUBLE) + CAST(reservation_unused_recurring_fee AS DOUBLE)) AS \"Unused Reserved\"\nFROM \n  $CurTable\nWHERE \n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\n  AND line_item_product_code = 'AmazonElastiCache'\n  -- AND line_item_line_item_type IN ('Usage','Fee','RIFee','DiscountedUsage')\n  AND product_product_family NOT IN ('Data Transfer')\nGROUP BY \n  1",
              "refId": "A"
            }
          ],
          "title": "ElastiCache Purchase Type Coverage -  Amortized",
          "transformations": [
            {
              "id": "groupBy",
              "options": {
                "fields": {
                  "case_purchase_option": {
                    "aggregations": [
                      "sum"
                    ]
                  },
                  "sum_amortized_cost": {
                    "aggregations": [
                      "sum"
                    ]
                  }
                }
              }
            }
          ],
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "Breakdown of Amazon Redshift On-Demand and Reserved Instance Coverage",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-BlPu"
              },
              "custom": {
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "scheme",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineStyle": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                },
                "lineWidth": 1,
                "pointSize": 2,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 21
          },
          "id": 84,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 1,
              "rawSQL": "SELECT \n  date_trunc('$Granularity', line_item_usage_start_date),\n  SUM(CAST(CASE\n    WHEN line_item_line_item_type IN ('Usage') THEN line_item_unblended_cost\n    ELSE 0\n    END AS DOUBLE)) AS \"On-Demand\",\n  SUM(CAST(reservation_effective_cost AS DOUBLE)) AS \"Reserved\",\n  SUM(CAST(reservation_unused_amortized_upfront_fee_for_billing_period AS DOUBLE) + CAST(reservation_unused_recurring_fee AS DOUBLE)) AS \"Unused Reserved\"\nFROM \n  $CurTable\nWHERE \n  $__timeFilter(line_item_usage_start_date)\n  and product_location in ($Regions)\n  AND  line_item_product_code in ($Services)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  AND line_item_line_item_type IN ($ChargeType)\n  AND line_item_product_code = 'AmazonRedshift'\n  -- AND line_item_line_item_type IN ('Usage','Fee','RIFee','DiscountedUsage')\n  AND product_product_family NOT IN ('Data Transfer')\nGROUP BY \n  1",
              "refId": "A"
            }
          ],
          "title": "Redshift Purchase Type Coverage -  Amortized",
          "transformations": [
            {
              "id": "groupBy",
              "options": {
                "fields": {
                  "case_purchase_option": {
                    "aggregations": [
                      "sum"
                    ]
                  },
                  "sum_amortized_cost": {
                    "aggregations": [
                      "sum"
                    ]
                  }
                }
              }
            }
          ],
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-athena-datasource",
            "uid": "${Datasource}"
          },
          "description": "This table allows you to parse your savings plan at the set granularity.  It reports the purchasing account and the percentage utilized.  This table allows only the linked_account,  granularity and tag filters.\n\nThe linked account filter will display where the savings plan was used.\nThe tag filter will display the savings plans which were utilized by the tag.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green"
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "plan_id"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 339
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 11,
            "w": 24,
            "x": 0,
            "y": 29
          },
          "id": 86,
          "options": {
            "footer": {
              "countRows": false,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": false
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "purchase_term"
              }
            ]
          },
          "pluginVersion": "9.4.7",
          "targets": [
            {
              "connectionArgs": {
                "catalog": "__default",
                "database": "__default",
                "region": "__default",
                "resultReuseEnabled": false,
                "resultReuseMaxAgeInMinutes": 60
              },
              "datasource": {
                "type": "grafana-athena-datasource",
                "uid": "${Datasource}"
              },
              "format": 1,
              "rawSQL": "SELECT\n  date_trunc('$Granularity', line_item_usage_start_date) as usage_month,\n  -- DATE_FORMAT((line_item_usage_start_date),'%Y-%m') AS usage_month,\n    -- (used commitment / total commitment) * 100 = utilization %\n  TRY_CAST(((SUM(TRY_CAST(savings_plan_used_commitment AS DECIMAL(16, 8))) / SUM(TRY_CAST(savings_plan_total_commitment_to_date AS DOUBLE))) * 100) AS DECIMAL(3, 0)) AS \"savings_plan_utilization\",\n  savings_plan_end_time AS \"expiration_date\",\n  SPLIT_PART(savings_plan_savings_plan_a_r_n, '/', 2) AS \"plan_id\",\n  bill_payer_account_id AS \"payer_account_number\",\n  SPLIT_PART(savings_plan_savings_plan_a_r_n, ':', 5) AS \"purchasing_account_number\",\n  savings_plan_offering_type AS \"offering_type\",\n  savings_plan_region AS \"region\",\n  -- DATE_FORMAT(FROM_ISO8601_TIMESTAMP(savings_plan_start_time),'%Y-%m-%d') AS day_savings_plan_start_time,\n  savings_plan_payment_option AS \"payment_option\",\n  savings_plan_purchase_term AS \"purchase_term\",\n  SUM(TRY_CAST(savings_plan_total_commitment_to_date AS DOUBLE)) AS \"amortized_total_commitment_to_date\", \n  SUM(TRY_CAST(savings_plan_used_commitment AS DOUBLE)) AS \"used_commitment\",\n  AVG(CASE\n    WHEN line_item_line_item_type = 'SavingsPlanRecurringFee' THEN TRY_CAST(savings_plan_total_commitment_to_date AS DOUBLE)\n  END) AS \"Hourly Commitment\"\nFROM\n  $CurTable\nWHERE \n  $__timeFilter(line_item_usage_start_date)\n  AND line_item_usage_account_id IN ($LinkedAccounts)\n  -- and product_location in ($Regions)\n  -- AND  line_item_product_code in ($Services)\n  AND resource_tags_user_$TagKey IN ($TagValue)\n  -- AND line_item_line_item_type IN ($ChargeType)\n  AND savings_plan_savings_plan_a_r_n <> ''\n  AND (line_item_line_item_type = 'SavingsPlanRecurringFee' OR line_item_line_item_type = 'SavingsPlanCoveredUsage')\nGROUP BY\n  -- SPLIT_PART(savings_plan_savings_plan_a_r_n, '/', 2),\n  1, 3, 4, 5, 6,\n  savings_plan_offering_type,\n  savings_plan_region,\n  -- DATE_FORMAT(FROM_ISO8601_TIMESTAMP(savings_plan_start_time),'%Y-%m-%d'),\n  savings_plan_end_time,\n  savings_plan_payment_option,\n  savings_plan_purchase_term\nORDER BY\n  usage_month DESC,\n  savings_plan_utilization ASC,\n  savings_plan_end_time DESC;\n",
              "refId": "A"
            }
          ],
          "title": "Savings Plans Explorer",
          "type": "table"
        }
      ],
      "title": "Purchase Type View",
      "type": "row"
    }
  ],
  "refresh": "",
  "revision": 1,
  "schemaVersion": 38,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "COAST-2023-09-19",
          "value": "COAST-2023-09-19"
        },
        "hide": 2,
        "includeAll": false,
        "multi": false,
        "name": "Datasource",
        "options": [],
        "query": "grafana-athena-datasource",
        "queryValue": "",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "hide": 2,
        "includeAll": false,
        "label": "CUR Table",
        "multi": false,
        "name": "CurTable",
        "options": [],
        "query": {
          "rawSQL": "show tables"
        },
        "refresh": 1,
        "regex": "^(?!cost_and_usage_data_status).+$",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "description": "Select Linked Account",
        "hide": 0,
        "includeAll": true,
        "label": "Linked Accounts",
        "multi": true,
        "name": "LinkedAccounts",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT DISTINCT(line_item_usage_account_id) FROM $CurTable;"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 3,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "hide": 0,
        "includeAll": true,
        "label": "Regions",
        "multi": true,
        "name": "Regions",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "select distinct product_location from $CurTable where product_location != '';"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 1,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "hide": 0,
        "includeAll": true,
        "label": "Services",
        "multi": true,
        "name": "Services",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "select distinct line_item_product_code from $CurTable;\n"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 1,
        "type": "query"
      },
      {
        "current": {
          "selected": true,
          "text": "month",
          "value": "month"
        },
        "description": "Adjust the period granularity for cost graphs",
        "hide": 0,
        "includeAll": false,
        "label": "Granularity",
        "multi": false,
        "name": "Granularity",
        "options": [
          {
            "selected": true,
            "text": "month",
            "value": "month"
          },
          {
            "selected": false,
            "text": "day",
            "value": "day"
          },
          {
            "selected": false,
            "text": "hour",
            "value": "hour"
          }
        ],
        "query": "month,day,hour",
        "queryValue": "",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "hide": 0,
        "includeAll": true,
        "label": "Charge Type",
        "multi": true,
        "name": "ChargeType",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT DISTINCT(line_item_line_item_type) from $CurTable;"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 1,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "hide": 0,
        "includeAll": false,
        "label": "Tag Key",
        "multi": false,
        "name": "TagKey",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "show columns from $CurTable;"
        },
        "refresh": 1,
        "regex": "/resource_tags_user_(.+)/",
        "skipUrlSync": false,
        "sort": 1,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "hide": 0,
        "includeAll": true,
        "label": "Tag Value",
        "multi": true,
        "name": "TagValue",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "select DISTINCT(resource_tags_user_$TagKey) \nFROM $CurTable;"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 1,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "hide": 2,
        "includeAll": false,
        "label": "Cost Category Name",
        "multi": false,
        "name": "CostCategoryName",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "show columns from $CurTable;"
        },
        "refresh": 1,
        "regex": "/cost_category_(.+)/",
        "skipUrlSync": false,
        "sort": 1,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "hide": 2,
        "includeAll": true,
        "label": "Cost Category Value",
        "multi": true,
        "name": "CostCategoryValue",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "select DISTINCT(cost_category_$CostCategoryName) \nFROM $CurTable;"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "description": "Calculate the spend percentage from the top 25 accounts in the AWS Organization.",
        "hide": 2,
        "includeAll": false,
        "multi": false,
        "name": "PanelTop25SpendPercentage",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "with total_spend as (\n    SELECT\n    line_item_usage_account_id as account,\n    sum(line_item_unblended_cost) as total_spend\n    FROM\n    $CurTable\n    where\n    bill_billing_period_start_date = date_add('MONTH', -1, DATE_TRUNC('MONTH', current_date))\n    Group by \n    line_item_usage_account_id\n),\n\ntop10_spend as (\n    SELECT\n    line_item_usage_account_id as account,\n    sum(line_item_unblended_cost) as top25_spend\n    FROM\n    $CurTable\n    where\n    bill_billing_period_start_date = date_add('MONTH', -1, DATE_TRUNC('MONTH', current_date))\n    Group by \n    line_item_usage_account_id\n    LIMIT 10\n)\n\n\nSELECT\n    CAST( (sum(top10_spend) / sum(total_spend) * 100) as VARCHAR) as percentage_from_top25\nFROM\n    total_spend\nINNER JOIN top10_spend ON total_spend.account = top10_spend.account;\n"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {},
        "datasource": {
          "type": "grafana-athena-datasource",
          "uid": "${Datasource}"
        },
        "definition": "",
        "hide": 2,
        "includeAll": false,
        "multi": false,
        "name": "TotalAccountInOrganization",
        "options": [],
        "query": {
          "connectionArgs": {
            "catalog": "__default",
            "database": "__default",
            "region": "__default",
            "resultReuseEnabled": false,
            "resultReuseMaxAgeInMinutes": 60
          },
          "format": 1,
          "rawSQL": "SELECT \nCAST(COUNT(DISTINCT(line_item_usage_account_id)) as VARCHAR) as account_count\nFROM \n$CurTable\n"
        },
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-1y",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "COAST - FinOps Dashboard",
  "uid": "FPN3tqSVKK",
  "version": 104,
  "weekStart": ""
}